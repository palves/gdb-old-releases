# Makefile for Texinfo distribution.	-*- Indented-Text -*-
# Copyright (C) 1993 Free Software Foundation, Inc.

# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2, or (at your option)
# any later version.

# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.

#### Start of system configuration section. ####

srcdir = @srcdir@
VPATH  = @srcdir@

CC = @CC@

INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@

LN	= ln
RM	= rm -f
TAR	= tar
MKDIR	= mkdir

DEFS = @DEFS@
LIBS = @LIBS@
LOADLIBES = $(LIBS)

SHELL = /bin/sh

CFLAGS = -g
LDFLAGS = -g

prefix = /usr/local
exec_prefix = $(prefix)
bindir = $(exec_prefix)/bin
# Prefix for each installed program, normally empty or `g'.
binprefix = 
libdir = $(prefix)/lib
# Prefix for each installed man page, normally empty or `g'.
manprefix = 
mandir = $(prefix)/man/man1
manext = 1
infodir = $(prefix)/info

MAKEINFO = makeinfo
TEXI2DVI = texi2dvi

MAKEOVERRIDES=
FLAGS_TO_PASS = \
	"CC=$(CC)" \
	"CFLAGS=$(CFLAGS)" \
	"INSTALL=$(INSTALL)" \
	"INSTALL_DATA=$(INSTALL_DATA)" \
	"INSTALL_PROGRAM=$(INSTALL_PROGRAM)" \
	"MAKEINFO=$(MAKEINFO)" \
	"TEXI2DVI=$(TEXI2DVI)" \
	"exec_prefix=$(exec_prefix)" \
	"prefix=$(prefix)" 

#### End of system configuration section. ####

VERSION = 3.0
DISTNAME = texinfo-$(VERSION)

# Subdirectories that have makefiles
SUBDIRS =  makeinfo info util

# All subdirectories that go into a distribution
ALL_SUBDIRS = $(SUBDIRS) emacs-lisp

all: sub-all 

check:
installcheck:

.PHONY: info
info: texinfo.info  license.info  lgpl.info
	@for dir in $(SUBDIRS); do cd $$dir; $(MAKE) $(FLAGS_TO_PASS) $@; cd ..; done

.PHONY: dvi
dvi: texinfo.dvi license.dvi lgpl.dvi
	@for dir in $(SUBDIRS); do cd $$dir; $(MAKE) $(FLAGS_TO_PASS) $@; cd ..; done

.PHONY: install
install:
	@for dir in $(SUBDIRS); do cd $$dir; $(MAKE) $(FLAGS_TO_PASS) $@; cd ..; done

# this target is cygnus local
.PHONY: install-info
install-info: info
	for f in texinfo.info* license.info* ; do $(INSTALL_DATA) $$f $(infodir)/$$f; done
	@for dir in $(SUBDIRS); do cd $$dir; $(MAKE) $(FLAGS_TO_PASS) $@; cd ..; done

uninstall:
	@for dir in $(SUBDIRS); do cd $$dir; $(MAKE) $(FLAGS_TO_PASS) $@; cd ..; done
	rm -f $(infodir)/texinfo.info*

Makefile: Makefile.in config.status
	$(SHELL) ./config.status

config.status: configure
	$(srcdir)/configure --srcdir=$(srcdir) --no-create

sub-all clean mostlyclean TAGS:
	@for dir in $(SUBDIRS); do \
	  if (cd $$dir; $(MAKE) $(FLAGS_TO_PASS) $@) ; \
	    then true ; \
	    else exit 1; \
	  fi ; \
	done

distclean: clean
	@for dir in $(SUBDIRS); do cd $$dir; $(MAKE) $(FLAGS_TO_PASS) $@; cd ..; done
	rm -f Makefile config.status config.log config.cache

realclean: distclean
	@for dir in $(SUBDIRS); do cd $$dir; $(MAKE) $(FLAGS_TO_PASS) $@; cd ..; done
	rm -f TAGS

texinfo.info: $(srcdir)/texinfo2.texi
	$(MAKEINFO) -o texinfo.info $(srcdir)/texinfo2.texi

texinfo.dvi: $(srcdir)/texinfo2.texi
	$(TEXI2DVI) $(srcdir)/texinfo2.texi

license.info: $(srcdir)/license.texi
	$(MAKEINFO) -I$(srcdir) -o license.info $(srcdir)/license.texi

license.dvi: $(srcdir)/license.texi
	$(TEXI2DVI) $(srcdir)/license.texi

lgpl.info: $(srcdir)/liblic.texi
	$(MAKEINFO) -I$(srcdir) -o lgpl.info $(srcdir)/liblic.texi

lgpl.dvi: $(srcdir)/liblic.texi
	$(TEXI2DVI) $(srcdir)/liblic.texi
	mv liblic.dvi lgpl.dvi

dist: DISTFILES
	rm -rf $(DISTNAME)
	mkdir $(DISTNAME)
	for d in $(ALL_SUBDIRS); do mkdir $(DISTNAME)/$$d; done
	for f in `cat DISTFILES`; do ln $(srcdir)/$$f $(DISTNAME)/$$f;	done
	tar chZf $(DISTNAME).tar.Z $(DISTNAME)
	rm -rf $(DISTNAME)

# Gets rid of most of the unwanted files.  Verify manually (if necessary)
# that this produces a list of all the files desired in the distribution. 
DISTFILES: force
	(cd $(srcdir); find . $(ALL_SUBDIRS) ! -type d -print) \
	| sed  '/\/RCS\//d; \
	       /\.tar.*/d; \
	       /~$$/d; /\.o$$/d; \
	       /\/config\.status$$/d; \
	       /\/Makefile$$/d;	\
	       /\/.*\.BAK$$/d; \
	       /\/core$$/d; \
	       /\/a.out$$/d; \
	       /\/conftest\.c$$/d; \
	       /\.toc$$/d; \
	       /\.aux$$/d; /\.log$$/d; \
	       /\.cps$$/d; /\.cp$$/d; \
	       /\.fns$$/d; /\.fn$$/d; \
	       /\.tps$$/d; /\.tp$$/d; \
	       /\.vrs$$/d; /\.vr$$/d; \
	       /\.pgs$$/d; /\.pg$$/d; \
	       /\.kys$$/d; /\.ky$$/d; \
	       s/^.\///; /^\.$$/d;' \
	| sort | uniq > DISTFILES

force:

# Prevent GNU make v3 from overflowing arg limit on SysV.
.NOEXPORT:
