#### host, target, and site specific Makefile frags come in here.

srcdir = .
CFLAGS = -g

# List of test executables that we have available.  They are kept in
# uuencoded format to avoid SCCS/RCS problems with binary files.

CROSS_EXECUTABLES = m68k-elf m68k-aout m68k-aout2 mips-ecoff i486-elf \
	sparc-aout i860-elf sparc-elf
EXECUTABLES = $(CROSS_EXECUTABLES) nodebug

all: $(EXECUTABLES) gdbme

nodebug: nodebug.o
	$(CC) $(LDFLAGS) -o nodebug nodebug.o $(LIBS)
# This gets compiled *without* -g, so don't add CFLAGS here.
nodebug.o: nodebug.c
	$(CC) -c $(srcdir)/nodebug.c

# For VPATH and Sun Make, we have to make explicit dependencies.
# DEC make doesn't seem to understand the ".u" dependency w/VPATH either.

m68k-elf: $(srcdir)/m68k-elf.u
	uudecode $(srcdir)/m68k-elf.u

m68k-aout: $(srcdir)/m68k-aout.u
	uudecode $(srcdir)/m68k-aout.u

m68k-aout2: $(srcdir)/m68k-aout2.u
	uudecode $(srcdir)/m68k-aout2.u

mips-ecoff: $(srcdir)/mips-ecoff.u
	uudecode $(srcdir)/mips-ecoff.u

i486-elf: $(srcdir)/i486-elf.u
	uudecode $(srcdir)/i486-elf.u

sparc-aout: $(srcdir)/sparc-aout.u
	uudecode $(srcdir)/sparc-aout.u

i860-elf: $(srcdir)/i860-elf.u
	uudecode $(srcdir)/i860-elf.u

sparc-elf: $(srcdir)/sparc-elf.u
	uudecode $(srcdir)/sparc-elf.u

.PHONY: all clean mostlyclean distclean realclean

all: gdbme

gdbme: gdbme.o
	$(CC) $(CFLAGS) $(LDFLAGS) -o gdbme gdbme.o $(LIBS)

gdbme.o: gdbme.c
	$(CC) $(CFLAGS) -c $(srcdir)/gdbme.c

clean mostlyclean:
	-rm -f *.o gdbme *.diff *~ *.bad core foo $(EXECUTABLES)

distclean realclean: clean
	-rm -f Makefile config.status

Makefile: $(srcdir)/Makefile.in $(host_makefile_frag) $(target_makefile_frag)
	$(SHELL) ./config.status
